function draw(e,t,n,r,i,s,o,u){var a=960,f=340,l=18,c=30,h="%b";t+=" div.chart_content";$(t+" svg").remove();var p=t;$.each(e,function(t,n){e[t].date_raw=n.date;e[t].date=+(new Date(n.date))});var d=d3.min(d3.values(e),function(e){return e.date}),v=d3.max(d3.values(e),function(e){return e.date}),m=0,g=d3.max(d3.values(e),function(e){return e.percentage});g+=.03;v+=1e8;var y=d3.mean(d3.values(e),function(e){return e.percentage});var b=d3.time.scale().domain([d,v]).range([l+16,a-l]);var w=d3.scale.linear().domain([m,g]).range([f-c+2,c-6]);var E=d3.svg.axis().scale(b).orient("bottom").tickFormat(d3.time.format(h)).ticks(15);$(".x g text").attr("text-anchor","left");var S=d3.svg.axis().scale(w).orient("left").tickFormat(d3.format(n)).ticks(7);var x=d3.select(t).append("svg").attr("width",a).attr("height",f);x.append("svg:line").attr("y1",250).attr("y2",250).attr("x1",795).attr("x2",815).style("stroke","black");x.append("svg:line").attr("y1",250).attr("y2",250).attr("x1",890).attr("x2",910).style("stroke","black");x.append("svg:text").text("NO DATA* ").attr("dx",826).attr("dy",254).style("font-size","11");var T=x.selectAll(".ticky").data(w.ticks(7)).enter().append("svg:g").attr("transform",function(e){return"translate(0, "+w(e)+")"}).attr("class","ticky").append("svg:line").attr("y1",-1).attr("y2",-1).attr("x1",c+5).attr("x2",a-c+8);var E=x.append("g").attr("class","axis x").attr("transform","translate(0,"+(f-l-3)+")").call(E);x.append("g").attr("class","axis y").attr("transform","translate("+(c+10)+",0)").call(S);var N=d3.svg.area().x(function(e){return b(e.date)}).y0(function(e){return w(0)}).y1(function(e){return w(e.percentage)});x.selectAll(".area").data(d3.values(e)).enter().insert("svg:path",".area_line").attr("class","area").attr("d",N(e)).style("opacity",.9).style("fill","#e8e8e8").style("fill-opacity",1);T=x.selectAll(".tickx").data(b.ticks(21)).enter().append("svg:g").attr("transform",function(e,t){return"translate("+b(e)+", 0)"}).attr("class","tickx");T.append("svg:line").attr("y1",f-l).attr("y2",f-l-7).attr("x1",0).attr("x2",0);var C=d3.svg.line().x(function(e,t){return b(e.value.date)}).y(function(e){return w(e.value.percentage)});var k=x.append("svg:path").attr("class","default_path_format").attr("d",function(){return C(d3.entries(e))});var L=x.selectAll("circle").data(d3.values(e)).enter().append("circle").attr("class",function(e,t){return"point_"+t+" point"}).attr("opacity",1).attr("cx",function(e){return b(e.date)}).attr("cy",function(e){return w(e.percentage)}).attr("r",4).each(function(t,n){var r=new Date(t.date*1e3);var i=r.getFullYear()+"-"+("0"+(r.getMonth()+1)).slice(-2)+"-"+("0"+r.getDate()).slice(-2);var s=Date.parse(t.date_raw).toString("MMM yyyy");if(s=="Jul 2013"||s=="Aug 2013"||s=="Sep 2013"||s=="Oct 2013"||s=="Nov 2013"||s=="Dec 2013"){return true}if("undefined"!=typeof o[i]){d3.select(p+" svg").append("svg:line").attr("class","annotation_line").attr("stroke-dasharray","1,3").attr("y1",17).attr("y2",f-15).attr("x1",b(t.date)).attr("x2",b(t.date));d3.select(p+" svg").append("svg:text").attr("class","annotation_text").text(o[i].annotation).attr("y",24).attr("x",b(t.date)+4)}x.append("rect").attr("shape-rendering","crispEdges").style("opacity",0).attr("x",function(){return b(t.date)-(a-l)/e.length/2}).attr("y",0).attr("class",function(){return"trans_rect_"+n+" trans_rect"}).attr("width",function(){return(a-l)/e.length}).attr("height",f-c+2).on("mouseover.tooltip",function(e){d3.select(".tooltip_box").remove();d3.selectAll(".tooltip").remove();d3.selectAll(".tooltip_date").remove();var n=Date.parse(t.date_raw).toString("MMM yyyy");$("#tooltip").show().html((t.percentage*100).toFixed(2)+"%<br /><span style='font-size:13px'>"+n+"</span>").css("left",d3.event.pageX-40+"px").css("top",w(t.percentage)+110+"px")})})}function drawSparkLine(e,t){if(e==undefined)return;var n=230,r=35,i=0,s=10,o="%b %e";var u=t;var a=d3.min(d3.values(e),function(e){return e.date}),f=d3.max(d3.values(e),function(e){return e.date}),l=d3.min(d3.values(e),function(e){return e.percentage}),c=d3.max(d3.values(e),function(e){return e.percentage});c+=.1;var h=d3.time.scale().domain([a,f]).range([i+16,n-i]);var p=d3.scale.linear().domain([l,c]).range([r-s+2,s-6]);var d=d3.svg.axis().scale(h).orient("bottom").tickFormat(d3.time.format(o)).ticks(10);$(".x g text").attr("text-anchor","left");var v=d3.svg.axis().scale(p).orient("left").tickFormat(d3.format("%")).ticks(4);var m=d3.select(t).append("svg").attr("width",n).attr("height",r);var d=m.append("g").attr("class","axis x").attr("transform","translate(-26,"+(r-i-3)+")").call(d);m.append("g").attr("class","axis y").attr("transform","translate("+(s+10)+",0)").call(v);var g=d3.svg.line().interpolate("basis").x(function(e,t){return h(e.value.date)}).y(function(e){return p(e.value.percentage)});var y=m.append("svg:path").attr("class","the_glorious_line default_path_format").attr("d",function(){return g(d3.entries(e))});var b=m.selectAll("circle").data(d3.values(e)).enter().append("circle").attr("class",function(e,t){return"point_"+t+" point"}).attr("opacity",1).attr("cx",function(e){return h(e.date)}).attr("cy",function(e){return p(e.percentage)}).attr("r",0)}
function draw(C,l,s,v,A,E,d,n){var k=960,t=340,m=18,c=30,p="%b";l+=" div.chart_content";$(l+" svg").remove();var y=l;$.each(C,function(h,w){C[h].date_raw=w.date;C[h].date=+new Date(w.date)});var x=d3.min(d3.values(C),function(h){return h.date}),z=d3.max(d3.values(C),function(h){return h.date}),b=0,e=d3.max(d3.values(C),function(h){return h.percentage});e+=0.03;z+=100000000;var r=d3.mean(d3.values(C),function(h){return h.percentage});var D=d3.time.scale().domain([x,z]).range([m+16,k-m]);var f=d3.scale.linear().domain([b,e]).range([t-c+2,c-6]);var i=d3.svg.axis().scale(D).orient("bottom").tickFormat(d3.time.format(p)).ticks(15);$(".x g text").attr("text-anchor","left");var a=d3.svg.axis().scale(f).orient("left").tickFormat(d3.format(s)).ticks(7);var o=d3.select(l).append("svg").attr("width",k).attr("height",t);var B=o.selectAll(".ticky").data(f.ticks(7)).enter().append("svg:g").attr("transform",function(h){return"translate(0, "+(f(h))+")"}).attr("class","ticky").append("svg:line").attr("y1",-1).attr("y2",-1).attr("x1",c+5).attr("x2",k-c+8);var i=o.append("g").attr("class","axis x").attr("transform","translate(0,"+(t-m-3)+")").call(i);o.append("g").attr("class","axis y").attr("transform","translate("+(c+10)+",0)").call(a);var u=d3.svg.area().interpolate("basis").x(function(h){return D(h.date)}).y0(function(h){return f(0)}).y1(function(h){return f(h.percentage)});o.selectAll(".area").data(d3.values(C)).enter().insert("svg:path",".area_line").attr("class","area").attr("d",u(C)).style("fill","#e8e8e8").style("fill-opacity",1);B=o.selectAll(".tickx").data(D.ticks(21)).enter().append("svg:g").attr("transform",function(w,h){return"translate("+(D(w))+", 0)"}).attr("class","tickx");B.append("svg:line").attr("y1",t-m).attr("y2",t-m-7).attr("x1",0).attr("x2",0);var j=d3.svg.line().interpolate("basis").x(function(w,h){return D(w.value.date)}).y(function(h){return f(h.value.percentage)});var q=o.append("svg:path").attr("class","default_path_format").attr("d",function(){return j(d3.entries(C))});var g=o.selectAll("circle").data(d3.values(C)).enter().append("circle").attr("class",function(w,h){return"point_"+h+" point"}).attr("opacity",1).attr("cx",function(h){return D(h.date)}).attr("cy",function(h){return f(h.percentage)}).attr("r",4).each(function(G,F){var h=new Date(G.date*1000);var w=h.getFullYear()+"-"+("0"+(h.getMonth()+1)).slice(-2)+"-"+("0"+h.getDate()).slice(-2);if("undefined"!=typeof d[w]){d3.select(y+" svg").append("svg:line").attr("class","annotation_line").attr("stroke-dasharray","1,3").attr("y1",17).attr("y2",t-15).attr("x1",D(G.date)).attr("x2",D(G.date));d3.select(y+" svg").append("svg:text").attr("class","annotation_text").text(d[w].annotation).attr("y",24).attr("x",D(G.date)+4)}o.append("rect").attr("shape-rendering","crispEdges").style("opacity",0).attr("x",function(){return D(G.date)-(((k-m)/C.length)/2)}).attr("y",0).attr("class",function(){return"trans_rect_"+F+" trans_rect"}).attr("width",function(){return((k-m)/C.length)}).attr("height",t-c+2).on("mouseover.tooltip",function(I){d3.select(".tooltip_box").remove();d3.selectAll(".tooltip").remove();d3.selectAll(".tooltip_date").remove();var H=Date.parse(G.date_raw).toString("MMM yyyy");$("#tooltip").show().html((G.percentage*100).toFixed(2)+"%<br /><span style='font-size:13px'>"+H+"</span>").css("left",(d3.event.pageX-40)+"px").css("top",f(G.percentage)+110+"px")})})}function drawSparkLine(t,k){if(t==undefined){return}var j=230,p=35,l=0,c=10,n="%b %e";var r=k;var q=d3.min(d3.values(t),function(h){return h.date}),s=d3.max(d3.values(t),function(h){return h.date}),a=d3.min(d3.values(t),function(h){return h.percentage}),d=d3.max(d3.values(t),function(h){return h.percentage});d+=0.1;var u=d3.time.scale().domain([q,s]).range([l+16,j-l]);var e=d3.scale.linear().domain([a,d]).range([p-c+2,c-6]);var g=d3.svg.axis().scale(u).orient("bottom").tickFormat(d3.time.format(n)).ticks(10);$(".x g text").attr("text-anchor","left");var b=d3.svg.axis().scale(e).orient("left").tickFormat(d3.format("%")).ticks(4);var m=d3.select(k).append("svg").attr("width",j).attr("height",p);var g=m.append("g").attr("class","axis x").attr("transform","translate(-26,"+(p-l-3)+")").call(g);m.append("g").attr("class","axis y").attr("transform","translate("+(c+10)+",0)").call(b);var i=d3.svg.line().interpolate("basis").x(function(v,h){return u(v.value.date)}).y(function(h){return e(h.value.percentage)});var o=m.append("svg:path").attr("class","the_glorious_line default_path_format").attr("d",function(){return i(d3.entries(t))});var f=m.selectAll("circle").data(d3.values(t)).enter().append("circle").attr("class",function(v,h){return"point_"+h+" point"}).attr("opacity",1).attr("cx",function(h){return u(h.date)}).attr("cy",function(h){return e(h.percentage)}).attr("r",0)};
"use strict";var LANG,desktop_or_mobile="ff",desktop_or_mobile2="ff",desktop_or_mobile3="ff",desktop_or_mobile4="ff",map_or_states="map",date_granularity="monthly";var ff_country_data,fennec_country_data,ff_state_data,fennec_state_data;var yStateCoords=new Object();yStateCoords.AL=[-590,-250];yStateCoords.AK=[280,-290];yStateCoords.AZ=[410,-210];yStateCoords.AR=[410,-220];yStateCoords.CA=[1100,-123];yStateCoords.CO=[1195,-160];yStateCoords.CT=[1050,-65];yStateCoords.DE=[1355,-120];yStateCoords.DC=[-750,90];yStateCoords.FL=[-360,-120];yStateCoords.GA=[-30,-50];yStateCoords.HI=[560,-170];yStateCoords.ID=[960,190];yStateCoords.IL=[945,100];yStateCoords.IN=[1200,80];yStateCoords.IA=[1600,110];yStateCoords.KS=[-350,255];yStateCoords.KY=[-320,240];yStateCoords.LA=[80,130];yStateCoords.ME=[200,400];yStateCoords.MD=[460,280];yStateCoords.MA=[700,360];yStateCoords.MI=[1400,360];yStateCoords.MN=[1670,420];yStateCoords.MS=[-400,400];yStateCoords.MO=[-200,480];yStateCoords.MT=[340,640];yStateCoords.NE=[520,565];yStateCoords.NV=[1050,500];yStateCoords.NH=[700,600];yStateCoords.NJ=[1040,520];yStateCoords.NM=[1850,430];yStateCoords.NY=[-630,840];yStateCoords.NC=[-340,720];yStateCoords.ND=[260,880];yStateCoords.OH=[360,700];yStateCoords.OK=[800,670];yStateCoords.OR=[1360,840];yStateCoords.PA=[1100,750];yStateCoords.RI=[1300,750];yStateCoords.SC=[-600,880];yStateCoords.SD=[-75,1040];yStateCoords.TN=[100,840];yStateCoords.TX=[500,785];yStateCoords.UT=[920,930];yStateCoords.VT=[700,1000];yStateCoords.VA=[1250,860];yStateCoords.WA=[1950,1050];yStateCoords.WV=[-500,1100];yStateCoords.WI=[-180,1225];yStateCoords.WY=[300,1200];var state=new Object();state.AL="Alabama";state.AK="Alaska";state.AZ="Arizona";state.AR="Arkansas";state.CA="California";state.CO="Colorado";state.CT="Connecticut";state.DE="Delaware";state.DC="District Of Columbia";state.FL="Florida";state.GA="Georgia";state.HI="Hawaii";state.ID="Idaho";state.IL="Illinois";state.IN="Indiana";state.IA="Iowa";state.KS="Kansas";state.KY="Kentucky";state.LA="Louisiana";state.ME="Maine";state.MD="Maryland";state.MA="Massachusetts";state.MI="Michigan";state.MN="Minnesota";state.MS="Mississippi";state.MO="Missouri";state.MT="Montana";state.NE="Nebraska";state.NV="Nevada";state.NH="New Hampshire";state.NJ="New Jersey";state.NM="New Mexico";state.NY="New York";state.NC="North Carolina";state.ND="North Dakota";state.OH="Ohio";state.OK="Oklahoma";state.OR="Oregon";state.PA="Pennsylvania";state.RI="Rhode Island";state.SC="South Carolina";state.SD="South Dakota";state.TN="Tennessee";state.TX="Texas";state.UT="Utah";state.VT="Vermont";state.VA="Virginia";state.WA="Washington";state.WV="West Virginia";state.WI="Wisconsin";state.WY="Wyoming";state.PR="Puerto Rico";var country=new Object();country.AF="Afghanistan";country.AX="Åland Islands";country.AL="Albania";country.DZ="Algeria";country.AS="American Samoa";country.AD="Andorra";country.AO="Angola";country.AI="Anguilla";country.AQ="Antarctica";country.AG="Antigua and Barbuda";country.AR="Argentina";country.AM="Armenia";country.AW="Aruba";country.AU="Australia";country.AT="Austria";country.AZ="Azerbaijan";country.BS="Bahamas";country.BH="Bahrain";country.BD="Bangladesh";country.BB="Barbados";country.BY="Belarus";country.BE="Belgium";country.BZ="Belize";country.BJ="Benin";country.BM="Bermuda";country.BT="Bhutan";country.BO="Bolivia";country.BQ="Bonaire";country.BA="Bosnia and Herzegovina";country.BW="Botswana";country.BV="Bouvet Island";country.BR="Brazil";country.IO="British Indian Ocean Territory";country.BN="Brunei Darussalam";country.BG="Bulgaria";country.BF="Burkina Faso";country.BI="Burundi";country.KH="Cambodia";country.CM="Cameroon";country.CA="Canada";country.CV="Cape Verde";country.KY="Cayman Islands";country.CF="Central African Republic";country.TD="Chad";country.CL="Chile";country.CN="China";country.CX="Christmas Island";country.CC="Cocos (Keeling) Islands";country.CO="Colombia";country.KM="Comoros";country.CG="Congo";country.CD="Congo";country.CK="Cook Islands";country.CR="Costa Rica";country.CI="Côte d'Ivoire";country.HR="Croatia";country.CU="Cuba";country.CW="Curaçao";country.CY="Cyprus";country.CZ="Czech Republic";country.DK="Denmark";country.DJ="Djibouti";country.DM="Dominica";country.DO="Dominican Republic";country.EC="Ecuador";country.EG="Egypt";country.SV="El Salvador";country.GQ="Equatorial Guinea";country.ER="Eritrea";country.EE="Estonia";country.ET="Ethiopia";country.FK="Falkland Islands (Malvinas)";country.FO="Faroe Islands";country.FJ="Fiji";country.FI="Finland";country.FR="France";country.GF="French Guiana";country.PF="French Polynesia";country.TF="French Southern Territories";country.GA="Gabon";country.GM="Gambia";country.GE="Georgia";country.DE="Germany";country.GH="Ghana";country.GI="Gibraltar";country.GR="Greece";country.GL="Greenland";country.GD="Grenada";country.GP="Guadeloupe";country.GU="Guam";country.GT="Guatemala";country.GG="Guernsey";country.GN="Guinea";country.GW="Guinea-Bissau";country.GY="Guyana";country.HT="Haiti";country.HM="Heard Island and McDonald Islands";country.VA="Holy See";country.HN="Honduras";country.HK="Hong Kong";country.HU="Hungary";country.IS="Iceland";country.IN="India";country.ID="Indonesia";country.IR="Iran";country.IQ="Iraq";country.IE="Ireland";country.IM="Isle of Man";country.IL="Israel";country.IT="Italy";country.JM="Jamaica";country.JP="Japan";country.JE="Jersey";country.JO="Jordan";country.KZ="Kazakhstan";country.KE="Kenya";country.KI="Kiribati";country.KP="North Korea";country.KR="South Korea";country.KW="Kuwait";country.KG="Kyrgyzstan";country.LA="Lao";country.LV="Latvia";country.LB="Lebanon";country.LS="Lesotho";country.LR="Liberia";country.LY="Libya";country.LI="Liechtenstein";country.LT="Lithuania";country.LU="Luxembourg";country.MO="Macao";country.MK="Macedonia";country.MG="Madagascar";country.MW="Malawi";country.MY="Malaysia";country.MV="Maldives";country.ML="Mali";country.MT="Malta";country.MH="Marshall Islands";country.MQ="Martinique";country.MR="Mauritania";country.MU="Mauritius";country.YT="Mayotte";country.MX="Mexico";country.FM="Micronesia";country.MD="Moldova";country.MC="Monaco";country.MN="Mongolia";country.ME="Montenegro";country.MS="Montserrat";country.MA="Morocco";country.MZ="Mozambique";country.MM="Myanmar";country.NA="Namibia";country.NR="Nauru";country.NP="Nepal";country.NL="Netherlands";country.NC="New Caledonia";country.NZ="New Zealand";country.NI="Nicaragua";country.NE="Niger";country.NG="Nigeria";country.NU="Niue";country.NF="Norfolk Island";country.MP="Northern Mariana Islands";country.NO="Norway";country.OM="Oman";country.PK="Pakistan";country.PW="Palau";country.PS="Palestinian Territory";country.PA="Panama";country.PG="Papua New Guinea";country.PY="Paraguay";country.PE="Peru";country.PH="Philippines";country.PN="Pitcairn";country.PL="Poland";country.PT="Portugal";country.QA="Qatar";country.RE="Réunion";country.RO="Romania";country.RU="Russian Federation";country.RW="Rwanda";country.BL="Saint Barthélemy";country.SH="Saint Helena";country.KN="Saint Kitts and Nevis";country.LC="Saint Lucia";country.MF="Saint Martin (French part)";country.PM="Saint Pierre and Miquelon";country.VC="Saint Vincent and the Grenadines";country.WS="Samoa";country.SM="San Marino";country.ST="Sao Tome and Principe";country.SA="Saudi Arabia";country.SN="Senegal";country.RS="Serbia";country.SC="Seychelles";country.SL="Sierra Leone";country.SG="Singapore";country.SX="Sint Maarten (Dutch part)";country.SK="Slovakia";country.SI="Slovenia";country.SB="Solomon Islands";country.SO="Somalia";country.ZA="South Africa";country.GS="South Georgia and the South Sandwich Islands";country.SS="South Sudan";country.ES="Spain";country.LK="Sri Lanka";country.SD="Sudan";country.SR="Suriname";country.SJ="Svalbard and Jan Mayen";country.SZ="Swaziland";country.SE="Sweden";country.CH="Switzerland";country.SY="Syria";country.TW="Taiwan";country.TJ="Tajikistan";country.TZ="Tanzania";country.TH="Thailand";country.TL="Timor-Leste";country.TG="Togo";country.TK="Tokelau";country.TO="Tonga";country.TT="Trinidad and Tobago";country.TN="Tunisia";country.TR="Turkey";country.TM="Turkmenistan";country.TC="Turks and Caicos Islands";country.TV="Tuvalu";country.UG="Uganda";country.UA="Ukraine";country.AE="United Arab Emirates";country.GB="United Kingdom";country.US="United States";country.UM="United States Minor Outlying Islands";country.UY="Uruguay";country.UZ="Uzbekistan";country.VU="Vanuatu";country.VE="Venezuela";country.VN="Vietnam";country.VG="Virgin Islands; British";country.VI="Virgin Islands; U.S.";country.WF="Wallis and Futuna";country.EH="Western Sahara";country.YE="Yemen";country.ZM="Zambia";country.ZW="Zimbabwe";$(document).ready(function(){if(!$.browser.mozilla){$("#download_firefox").show()}d3.json("lang/en_US.json",function(a){LANG=a;assignEventListeners();drawCharts("ff_dnt_perc_monthly.json");getCountryAndStateData();setTimeout(function(){drawMap();drawMapWorld()},1000)})});function getCountryAndStateData(a){d3.json("data/ff_dnt_perc_monthly_by_country.json",function(b){d3.json("data/fennec_dnt_perc_monthly_by_country.json",function(c){d3.json("data/ff_dnt_perc_monthly_by_state.json",function(d){d3.json("data/fennec_dnt_perc_monthly_by_state.json",function(e){ff_country_data=b;fennec_country_data=c;ff_state_data=d;fennec_state_data=e})})})})}function sort_data(a){return a;$.each(a,function(b,c){a[b].sort(function(e,d){if(e.date<d.date){return -1}if(e.date>d.date){return 1}return 0})})}function addLegend(a){var b="<div class='legend'><div class='legend_text'>HIGHEST ADOPTION</div><img src='images/gradient_key.png' style='float:left' /><div class='legend_text'>LOWEST ADOPTION</div></div>";$(a).append(b)}function redrawMap(){$("#map_data").fadeOut("fast");$("#map_legend").delay(1000).fadeIn("fast");d3.selectAll("#map svg .grey path").transition().duration(1000).attr("transform",function(f,c){var a=f.id,e=-1*yStateCoords[a][0],b=-1*yStateCoords[a][1];return"matrix(1, 0, 0, 1, "+e+", 1*"+b+")"});d3.json("data/"+desktop_or_mobile3+"_dnt_perc_monthly_by_state.json",function(b){var c=minMaxStateOrCountry(b);var a=d3.scale.linear().domain([c[0],c[1]]).range(["#d9e016","steelblue"]);$.each(b,function(e,f){var d=f[f.length-1];$("#"+e).css("fill",function(h){return a(d.percentage)});var g=((mom_growth(f,d)>0))?"<img src='images/up.png' class='up_down' />":"<img src='images/down.png' class='up_down' />";$("#"+e+"_box div").html((d.percentage*100).toFixed(0)+"%"+g)})})}function drawMap(){$("#map svg").remove();$("#map_data").fadeOut("fast");addLegend("#map_legend");d3.json("data/us-states.json",function(b){var a=d3.select("#map").append("svg").attr("width",960).attr("height",600);var c=d3.geo.path();a.append("g").attr("class","black").selectAll("path").data(b.features).enter().append("path").attr("d",c);a.append("g").attr("class","grey").selectAll("path").data(b.features).enter().append("path").attr("d",c).attr("id",function(e){return e.id}).style("stroke-width",function(e){}).on("mousemove",function(h){var g;if(desktop_or_mobile3=="ff"){g=ff_state_data}else{if(desktop_or_mobile3=="fennec"){g=fennec_state_data}}var f=g[(h.id)].length-1;var e=g[(h.id)][f];$("#tooltip").show().html(state[h.id]+"<br />"+(e.percentage*100).toFixed(2)+"%").css("left",(d3.event.pageX+35)+"px").css("top",(d3.event.pageY-35)+"px")});d3.json("data/"+desktop_or_mobile+"_dnt_perc_monthly_by_state.json",function(e){var f=minMaxStateOrCountry(e);var d=d3.scale.linear().domain([f[0],f[1]]).range(["#d9e016","steelblue"]);$.each(e,function(h,j){var g=j[j.length-1];$("#"+h).css("fill",function(i){return d(g.percentage)});var k=((mom_growth(j,g)>0))?"<img src='images/up.png' class='up_down' />":"<img src='images/down.png' class='up_down' />";$("#"+h+"_box div").html((g.percentage*100).toFixed(0)+"%"+k)})})})}function redrawMapWorld(){$("#map_legend_world").delay(1000).fadeIn("fast");d3.json("data/"+desktop_or_mobile4+"_dnt_perc_monthly_by_country.json",function(a){var c=minMaxStateOrCountry(a);var b=d3.scale.linear().domain([c[0],c[1]]).range(["#d9e016","steelblue"]);$.each(a,function(f,e){var d=e[e.length-1];$("#w"+f).css("fill",function(h){return b(d.percentage)});var g=((mom_growth(e,d)>0))?"<img src='images/up.png' class='up_down' />":"<img src='images/down.png' class='up_down' />";$("#"+f+"_box div").html((d.percentage*100).toFixed(0)+"%"+g)})})}function drawMapWorld(){$("#map_world svg").remove();addLegend("#map_legend_world");d3.json("data/world-countries.json",function(d){var c=980,e=540;var b=d3.select("#map_world").append("svg").attr("width",c).attr("height",e);var a=d3.geo.equirectangular().scale(890).translate([c/2,e/2+20]);var f=d3.geo.path().projection(a);b.append("g").attr("class","black").selectAll("path").data(d.features).enter().append("path").attr("d",f).attr("width",c).attr("height",e);b.append("g").attr("class","grey").selectAll("path").data(d.features).enter().append("path").attr("d",f).attr("id",function(g){return"w"+g.id}).style("stroke-width",0.3).on("mousemove",function(j){var i;if(desktop_or_mobile4=="ff"){i=ff_country_data}else{if(desktop_or_mobile4=="fennec"){i=fennec_country_data}}var h=i[(j.id)].length-1;var g=i[(j.id)][h];$("#tooltip").show().html(country[j.id]+"<br />"+(g.percentage*100).toFixed(2)+"%").css("left",(d3.event.pageX+35)+"px").css("top",(d3.event.pageY-35)+"px")});d3.json("data/"+desktop_or_mobile+"_dnt_perc_monthly_by_country.json",function(g){var i=minMaxStateOrCountry(g);var h=d3.scale.linear().domain([i[0],i[1]]).range(["#d9e016","steelblue"]);$.each(g,function(l,k){var j=k[k.length-1];$("#w"+l).css("fill",function(m){return h(j.percentage)})})})})}function minMaxStateOrCountry(c){var b=-1,a=-1;$.each(c,function(e,f){var d=f[f.length-1].percentage;if(d<b||b==-1){b=d}if(d>a||a==-1){a=d}});return[b,a]}function resortCountries(){var a=[[1,1],[0,0]];$("#ranked_table_countries").trigger("sorton",[a]);$("#ranked_table_countries tbody").fadeIn("fast")}function resortStates(){var a=[[1,1],[0,0]];$("#ranked_table_states").trigger("sorton",[a])}function populateStatesTable(b){var a="";d3.json("data/"+b+"_dnt_perc_monthly_by_state.json",function(c){$.each(c,function(e,f){var d=f[f.length-1];a+="<tr><td style='width:50%'>"+state[e]+"</td><td style='width:35%'>"+(d.percentage*100).toFixed(2)+"%</td><td style='width:15%'>"+(yoy_growth(f,d)*100).toFixed(2)+"%</td></tr>"});$("#ranked_table_states tbody").empty();$("#ranked_table_states tbody").html(a);$("#ranked_table_states").trigger("update");setTimeout(function(){resortStates()},1)})}function redrawStates(){d3.json("data/"+desktop_or_mobile3+"_dnt_perc_monthly_by_state.json",function(a){$.each(a,function(c,d){var b=d[d.length-1];var e=((mom_growth(d,b)>0))?"<img src='images/up.png' class='up_down' />":"<img src='images/down.png' class='up_down' />";$("#"+c+"_box div").html((b.percentage*100).toFixed(0)+"%"+e)})});$("#map_data").fadeIn("slow")}function drawStates(){d3.selectAll("#map svg .grey path").transition().duration(1000).style("fill","#f6f6f6").attr("transform",function(f,c){var a=f.id,e=yStateCoords[a][0],b=yStateCoords[a][1];return"matrix(.4, 0, 0, .4, "+0.4*e+", "+0.4*b+")"});$("#map_legend").fadeOut("slow");setTimeout(function(){$("#map_data").fadeIn("slow")},800)}function assignEventListeners(){/*$("#about").on("mouseenter",function(){$("#about_pane").show();return false});$("#about").on("click",function(){return false});$("#about_pane").on("mouseenter",function(){$("#about_pane").show();return false});$("#about").on("mouseleave",function(){$("#about_pane").hide();return false});$("#about_pane").on("mouseleave",function(){$("#about_pane").hide();return false});*/$("#tabzilla").toggle(function(){$("#dnt_status").hide()},function(){$("#dnt_status").delay(500).fadeIn("fast")});$("#page").on("mouseleave",function(){$("#tooltip").fadeOut("fast")});$("#dismiss").on("click",function(){$("#download_firefox").fadeOut("fast");return false});$("#show_map").on("click",function(){$("#tooltip").fadeOut();if(map_or_states=="map"){return false}shift_selected3("map","map");map_or_states="map";redrawMap();return false});$("#show_states").on("click",function(){$("#tooltip").fadeOut();if(map_or_states=="states"){return false}shift_selected3("states","map");map_or_states="states";drawStates();return false});$(".region_select").on("click",function(a){$("#tooltip").fadeOut();shift_selected4_region_select($(this).attr("id"));worldmapZoom($(this).attr("id"));return false});$("#desktop4").on("click",function(){$("#tooltip").fadeOut();if(desktop_or_mobile4=="ff"){return false}shift_selected4("desktop","platform");desktop_or_mobile4="ff";redrawMapWorld();return false});$("#mobile4").on("click",function(){$("#tooltip").fadeOut();if(desktop_or_mobile4=="fennec"){return false}shift_selected4("mobile","platform");desktop_or_mobile4="fennec";redrawMapWorld();return false});$("#desktop3").on("click",function(){$("#tooltip").fadeOut();if(desktop_or_mobile3=="ff"){return false}shift_selected3("desktop","platform");desktop_or_mobile3="ff";if(map_or_states=="map"){redrawMap()}else{if(map_or_states=="states"){redrawStates()}}return false});$("#mobile3").on("click",function(){$("#tooltip").fadeOut();if(desktop_or_mobile3=="fennec"){return false}shift_selected3("mobile","platform");desktop_or_mobile3="fennec";if(map_or_states=="map"){redrawMap()}else{if(map_or_states=="states"){redrawStates()}}return false});$("#desktop").on("click",function(){$("#tooltip").fadeOut();shift_selected("desktop","platform");desktop_or_mobile="ff";drawCharts(desktop_or_mobile+"_dnt_perc_"+date_granularity+".json");return false});$("#mobile").on("click",function(){$("#tooltip").fadeOut();shift_selected("mobile","platform");desktop_or_mobile="fennec";drawCharts(desktop_or_mobile+"_dnt_perc_"+date_granularity+".json");return false});$("#tooltip").on("click",function(){$(this).fadeOut()});$("#dnt_perc_daily").on("click",function(){shift_selected("daily","granularity");date_granularity="daily";drawCharts(desktop_or_mobile+"_dnt_perc_daily.json")});$("#dnt_perc_weekly").on("click",function(){shift_selected("weekly","granularity");date_granularity="weekly";drawCharts(desktop_or_mobile+"_dnt_perc_weekly.json")});$("#dnt_perc_monthly").on("click",function(){shift_selected("monthly","granularity");date_granularity="monthly";drawCharts(desktop_or_mobile+"_dnt_perc_monthly.json")})}function worldmapZoom(a){d3.selectAll("#map_world svg .grey path").transition().duration(1000).attr("transform",function(c,b){switch(a){case"the_world":return"scale(1) translate(0,0)";case"africa":return"scale(2.3) translate(-330,-160)";case"asia":return"scale(2.7) translate(-530,-140)";case"europe":return"scale(4.2) translate(-420,-100)";case"north_america":return"scale(2.5) translate(-50,-60)";case"oceania":return"scale(2.5) translate(-590,-200)";case"south_america":return"scale(2.5) translate(-150,-220)"}})}function shift_selected(b,a){if(a=="granularity"){$("#dnt_perc_daily").html("DAILY");$("#dnt_perc_weekly").html("WEEKLY");$("#dnt_perc_monthly").html("MONTHLY");$("#dnt_perc_"+b).html("<span class='selected_option'>"+b.toUpperCase()+"</span>")}else{if(a=="platform"){$("#desktop").html("DESKTOP");$("#mobile").html("MOBILE");$("#"+b).html("<span class='selected_option'>"+b.toUpperCase()+"</span>")}}}function shift_selected2(a){$("#desktop2").html("DESKTOP");$("#mobile2").html("MOBILE");$("#"+a+"2").html("<span class='selected_option'>"+a.toUpperCase()+"</span>")}function shift_selected3(b,a){if(a=="map"){$("#show_map").html("MAP");$("#show_states").html("STATES");$("#show_"+b).html("<span class='selected_option'>"+b.toUpperCase()+"</span>")}else{if(a=="platform"){$("#desktop3").html("DESKTOP");$("#mobile3").html("MOBILE");$("#"+b+"3").html("<span class='selected_option'>"+b.toUpperCase()+"</span>")}}}function shift_selected4(b,a){if(a=="platform"){$("#desktop4").html("DESKTOP");$("#mobile4").html("MOBILE");$("#"+b+"4").html("<span class='selected_option'>"+b.toUpperCase()+"</span>")}}function shift_selected4_region_select(a){$("#the_world").html("THE WORLD");$("#africa").html("AFRICA");$("#asia").html("ASIA");$("#europe").html("EUROPE");$("#south_america").html("SOUTH AMERICA");$("#oceania").html("OCEANIA");$("#north_america").html("NORTH AMERICA");$("#"+a).html("<span class='selected_option'>"+a.replace("_"," ").toUpperCase()+"</span>")}function drawCharts(a){d3.json("data/annotations.json",function(b){d3.json("data/"+a,function(f){var h="%",d=false,g="",c=0,e=false;setTimeout(function() {draw(f.GLOBAL,"#trend",h,d,g,c,b,e)},400);})})}function addCommas(e){e+="";var a=e.split(".");var d=a[0];var b=a.length>1?"."+a[1]:"";var c=/(\d+)(\d{3})/;while(c.test(d)){d=d.replace(c,"$1,$2")}return d+b}function getHumanSize(b){var a=" kmbtpezyxwvu";if(b<=0){return"0"}var c=Math.min(Math.floor(Math.log(b)/Math.log(1000)),12);return(Math.round(b*100/Math.pow(1000,c))/100)+a.charAt(c).replace(" ","")}function isNumber(a){return !isNaN(parseFloat(a))&&isFinite(a)};